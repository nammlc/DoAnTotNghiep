@page
@model DoAnTotNghiep.Pages.MapModel;
@{
    Layout = "_layout";
}

<style>
    .cafe-map {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        justify-content: center;
        padding: 20px;
    }
    .table-map, .counter, .door {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100px;
        height: 100px;
        padding: 10px;
        border: 2px solid #ccc;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        font-size: 14px;
        overflow: hidden;
    }
    .table-map {
        background-color: #ccc; /* BÃ n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng: mÃ u xÃ¡m */
    }
    .table-assigned {
        background-color: #4CAF50; /* BÃ n cÃ³ Ä‘Æ¡n hÃ ng: mÃ u xanh */
        color: white;
    }
    .counter {
        background-color: #ffe5b4;
        grid-column: 1 / span 1;
        grid-row: 4;
    }
    .door {
        background-color: #d1e7dd;
        grid-column: 2 / span 1;
        grid-row: 4;
    }
    .icon {
        font-size: 24px;
    }
</style>

<div>
    <h2>Báº£n Äá»“ QuÃ¡n Cafe</h2>
    
    <!-- Báº£n Ä‘á»“ quÃ¡n cafe vá»›i cÃ¡c bÃ n, quáº§y pha cháº¿ vÃ  cá»­a ra vÃ o -->
    <div class="cafe-map">
        @for (int i = 1; i <= 12; i++)
        {
            <div class="table-map" id="table-@i" onclick="openTable(@i)">
                <div class="icon">â˜•</div> 
                <div>BÃ n @i</div>
                <div class="order-info" id="assigned-order-@i">ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng</div>
            </div>
        }

        <!-- Quáº§y pha cháº¿ á»Ÿ gÃ³c dÆ°á»›i bÃªn trÃ¡i -->
        <div class="counter">
            <div class="icon">ğŸ¹</div> 
            <div>Quáº§y Pha Cháº¿</div>
        </div>

        <!-- Cá»­a ra vÃ o ngay cáº¡nh quáº§y pha cháº¿ -->
        <div class="door">
            <div class="icon">ğŸšª</div> 
            <div>Cá»­a Ra VÃ o</div>
        </div>
    </div>
</div>

<!-- Modal gÃ¡n Ä‘Æ¡n hÃ ng vÃ o bÃ n -->
<div id="assignOrderModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border-radius:8px; box-shadow:0 4px 8px rgba(0, 0, 0, 0.2);">
    <h3>GÃ¡n ÄÆ¡n HÃ ng cho BÃ n <span id="selectedTable"></span></h3>
    <select id="orderSelect">
        <option value="">Chá»n Ä‘Æ¡n hÃ ng</option>
        @foreach (var hoadon in Model.HoaDons)
        {
            <option value="@hoadon.ten_kh">TÃªn KH: @hoadon.ten_kh ; Tá»•ng hÃ³a Ä‘Æ¡n: @hoadon.tong_tien.ToString("#,##0") VNÄ ; Thá»i gian táº¡o hÃ³a Ä‘Æ¡n : @hoadon.gio_vao </option>
        }
    </select>
    <div style="margin-top: 10px;">
        <button onclick="assignOrder()">XÃ¡c Nháº­n</button>
        <button onclick="closeAssignOrderModal()">Há»§y</button>
    </div>
</div>

<!-- Modal xem thÃ´ng tin Ä‘Æ¡n hÃ ng -->
<div id="orderInfoModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border-radius:8px; box-shadow:0 4px 8px rgba(0, 0, 0, 0.2);">
    <h3>ThÃ´ng Tin ÄÆ¡n HÃ ng BÃ n <span id="orderTableNumber"></span></h3>
    <div id="orderDetails"></div>
    <div style="margin-top: 10px;">
        <button onclick="closeOrderInfoModal()">ÄÃ³ng</button>
    </div>
</div>

<script>
    let selectedTableId;
    let orderData = {}; // LÆ°u trá»¯ Ä‘Æ¡n hÃ ng theo bÃ n

    // Má»Ÿ modal gÃ¡n Ä‘Æ¡n hÃ ng khi bÃ n chÆ°a cÃ³ Ä‘Æ¡n
    function openTable(tableNumber) {
        selectedTableId = tableNumber;

        // Kiá»ƒm tra xem bÃ n Ä‘Ã£ cÃ³ Ä‘Æ¡n hÃ ng chÆ°a
        if (orderData[selectedTableId]) {
            // Náº¿u cÃ³ Ä‘Æ¡n, má»Ÿ modal xem chi tiáº¿t Ä‘Æ¡n hÃ ng
            openOrderInfoModal();
        } else {
            // Náº¿u chÆ°a cÃ³ Ä‘Æ¡n, má»Ÿ modal gÃ¡n Ä‘Æ¡n hÃ ng
            openAssignOrderModal();
        }
    }

    // Má»Ÿ modal gÃ¡n Ä‘Æ¡n hÃ ng
    function openAssignOrderModal() {
        document.getElementById("selectedTable").innerText = selectedTableId;
        document.getElementById("assignOrderModal").style.display = "block";
    }

    // ÄÃ³ng modal gÃ¡n Ä‘Æ¡n hÃ ng
    function closeAssignOrderModal() {
        document.getElementById("assignOrderModal").style.display = "none";
        document.getElementById("orderSelect").value = ""; // Reset chá»n Ä‘Æ¡n hÃ ng
    }

    // XÃ¡c nháº­n gÃ¡n Ä‘Æ¡n hÃ ng vÃ o bÃ n
    function assignOrder() {
        const selectedOrder = document.getElementById("orderSelect").value;
        if (!selectedOrder) {
            alert("Vui lÃ²ng chá»n Ä‘Æ¡n hÃ ng.");
            return;
        }

        // LÆ°u thÃ´ng tin Ä‘Æ¡n hÃ ng vÃ o bÃ n
        orderData[selectedTableId] = {
            customer: selectedOrder,
            items: [],
            totalAmount: 0 // Giáº£ sá»­ ban Ä‘áº§u tá»•ng tiá»n lÃ  0
        };

        // Cáº­p nháº­t giao diá»‡n
        document.getElementById("assigned-order-" + selectedTableId).innerText = "TÃªn KH: " + selectedOrder;
        document.getElementById("table-" + selectedTableId).classList.add("table-assigned");

        // ÄÃ³ng modal
        closeAssignOrderModal();
    }

    // Má»Ÿ modal xem thÃ´ng tin Ä‘Æ¡n hÃ ng
    function openOrderInfoModal() {
        const order = orderData[selectedTableId];
        document.getElementById("orderTableNumber").innerText = selectedTableId;
        document.getElementById("orderDetails").innerHTML = `
            <p>TÃªn KH: ${order.customer}</p>
            <p>Tá»•ng tiá»n Ä‘Ã£ thanh toÃ¡n: ${order.totalAmount} VNÄ</p>
            <p>Tá»•ng tiá»n chÆ°a thanh toÃ¡n: ${order.totalAmount} VNÄ</p>
            <p>Danh sÃ¡ch mÃ³n Äƒn: ${order.items.join(", ") || "ChÆ°a cÃ³ mÃ³n"}</p>
        `;
        document.getElementById("orderInfoModal").style.display = "block";
    }

    // ÄÃ³ng modal xem thÃ´ng tin Ä‘Æ¡n hÃ ng
    function closeOrderInfoModal() {
        document.getElementById("orderInfoModal").style.display = "none";
    }
</script>
